---
layout: post
title: "VB.net覚え書き3"
date: 2025-10-23 00:00:00
---

## VB.net
# パイプでプロセス間通信
# Server側
Private running As Boolean = True  
Private serverThread As Thread  

Private Sub Start()  
　　serverThread = New Thread(AddressOf RunPipeServer)  
　　serverThread.IsBackground = True  
　　serverThread.Start()  
End Sub

Private Sub RunPipeServer()  
　　While running  
　　　　Using pipeServer As New NamedPipeServerStream("ProcessComPipe", PipeDirection.In)  
　　　　　　pipeServer.WaitForConnection()  
　　　　　　Using reader As New StreamReader(pipeServer)  
　　　　　　　　Dim message As String = reader.ReadLine()  
　　　　　　　　If message IsNot Nothing Then  
　　　　　　　　　　Dispatcher.Invoke(Sub()  
　　　　　　　　　　　　　　　　　　　　Label.Content = message  
　　　　　　　　　　　　　　　　　　End Sub)  
　　　　　　　　End If  
　　　　　　End Using  
　　　　End Using  
　　End While  
End Sub  

# Client側
Imports System.IO.Pipes  
Imports System.Text

Private Sub Send()  
　　Dim pipeName As String = "ProcessComPipe"  
　　Dim message As String = InputTextBox.Text  
　　Try  
　　　　Using pipeClient As New NamedPipeClientStream(".", pipeName, PipeDirection.Out)  
　　　　　　pipeClient.Connect(2000) '2秒タイムアウト  
　　　　　　Dim buffer As Byte() = Encoding.UTF8.GetBytes(message)  
　　　　　　pipeClient.Write(buffer, 0, buffer.Length)  
　　　　End Using  
　　Catch ex As Exception  
　　　　MessageBox.Show($"送信失敗: {ex.Message}")  
　　End Try  
End Sub
